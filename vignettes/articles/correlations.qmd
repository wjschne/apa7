---
title: "Correlations"
crossref: 
  title-delim: "."
knitr:
  opts_chunk: 
    collapse: true
    comment: '#>'
    dev: "ragg_png"
    cache: false
format: 
  html:
    toc: true
    html-math-method: katex
vignette: >
  %\VignetteIndexEntry{Correlations}
  %\VignetteEngine{quarto::html}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
library(apa7)
library(dplyr)
library(flextable)
library(ftExtra)
library(tidyr)
library(stringr)
```

```{r loading}
<<setup>>
```

Some tables, like correlation matrices, can be standardized and automated. Others are uniquely tied to a specific purpose, and no function could anticipate their structure. The apa7 package has a few functions to automate what can be automated and a styling function to make the final styling of a complex table a little easier.

By default, the output of `apa_cor` [flextable](https://davidgohel.github.io/flextable/), with significant correlations bolded.

```{r}
#| label: tbl-treesflex
#| tbl-cap: Correlation table using flextable via `apa_cor`
#| message: false
trees |> 
  apa_cor()
```

Significant correlations can be bolded instead.

```{r}
#| label: tbl-stars
#| tbl-cap: Bolding significant correlations
#| message: false
trees |> 
  apa_cor(bold_significant = TRUE)
```




# Styling options

Your styling options include:

* `note` A custom markdown formatted note. Overrides automatic note about bolded correlations being significant. Default: `NULL`
* `p_value` Significance value. Default: `.05`
* `digits` Number of digits for rounding. Default: `2`
* `bold_significant` Whether to bold significant correlations. Default:  `FALSE`
* `star_significant` Whether to star significant correlations. Default: `TRUE`
* `significance_note` Whether note about bolding correlations appears. Overridden by a custom note. Also, the automatic note will not appear if no correlations are significant. Default:  `TRUE`
* `output` Options are `flextable` or `tibble`. Default: `flextable`
* `family` Font family (typeface). Default: `Times New Roman`
* `font_size` Font size (in points). Default: `12`
* `text_color` Text color. Default: `black`
* `border_color` Table border color. Default: `black`
* `border_width` Table border width. Default: `0.5`
* `line_spacing` Text line spacing. Default: `2`


For example, 

```{r altstyle}
# Named list of descriptive functions
my_summaries <- list(Median = median, "Interquartile Range" = IQR)

apa_cor(trees, summary_functions = my_summaries)
# or a vector descriptives
my_summaries <- c("n", "M", "SD", "Skewness", "Kurtosis")

trees |>
  apa_cor(
    p_value = .001,
    digits = 2,
    bold_significant = TRUE,
    significance_note = TRUE,
    summary_functions = my_summaries,
    font_family = "Arial",
    font_size = 10,
    text_color = "darkred",
    border_color = "royalblue4",
    border_width = 1,
    line_spacing = 2
  )
```

To remove summary statistics entirely, set `summary_functions` to `NA` or `NULL`.

```{r nosummary}
apa_cor(trees, summary_functions = NA, bold_significant = FALSE)
```

# Customization

The styling options for `apa_cor` are minimal, but flextable allows for all kinds of customization. Just place whatever code from flextable you want after `apa_cor`. Here I set the width to 50% and align the table to the left of the page. I place a footnote in a specific cell in the table body.


```{r altflextable}
apa_cor(trees) |>
  flextable::footnote(
    i = 2,
    j = "Variable",
    value = flextable::as_paragraph("This is a footnote."),
    part = "body"
  ) |>
  flextable::set_table_properties(
    width = .5,
    align = "left"
  )

```

# Output to tibble

If you need to process the underlying data before converting to flextable (or use another table-creating function from another package), you can output a tibble and then process the table however you want. Here we add a row title.

```{r}
apa_cor(trees, output = "tibble") |>
  mutate(apa7listcolumn = str_trim(apa7listcolumn)) |>
  unite(col = Variable, 
        apa7listcolumn, 
        Variable, 
        sep = "&thinsp;") |>
  add_row(Variable = "Row title", .before = 1) |>
  apa_flextable(no_format_columns = "Variable") |>
  padding(i = 2:4,
          j = 1,
          padding.left = 15) 
```

